<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>PrimeGlobalPro</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(135deg,#120f2e,#3b2fa3);
  color:#fff;
  padding-bottom:120px;
}
.balance-box{
  margin:24px;
  padding:26px;
  border-radius:28px;
  background:rgba(255,255,255,.18);
  backdrop-filter:blur(20px);
  text-align:center;
}
.balance{font-size:44px;font-weight:900}
.score{text-align:center;opacity:.85}
.robot-wrap{display:flex;justify-content:center;margin-top:40px}
.robot{
  width:180px;height:180px;border-radius:50%;
  background:radial-gradient(circle at top,#9ae6ff,#3b82f6);
  display:flex;align-items:center;justify-content:center;
  font-size:80px;cursor:pointer;
}
.nav-wrap{position:fixed;bottom:18px;left:0;right:0;display:flex;justify-content:center}
.nav{
  width:calc(100% - 48px);max-width:420px;height:64px;
  background:rgba(255,255,255,.9);
  border-radius:999px;display:flex;justify-content:space-around;align-items:center
}
.nav i{color:#666;font-size:22px}
.nav i.active{color:#3b2fa3}
.tap-fx{position:absolute;font-weight:800;animation:float 1s forwards}
@keyframes float{to{opacity:0;transform:translateY(-60px)}}
</style>
</head>

<body>

<div class="balance-box">
  <div>Balance</div>
  <div class="balance" id="balance">$0.00</div>
</div>

<div class="score">
  Score: <span id="score">0</span>
</div>

<div class="robot-wrap">
  <div class="robot" id="robot">ðŸ¤–</div>
</div>

<div class="nav-wrap">
  <div class="nav">
    <i class="fa-solid fa-house active"></i>
    <i class="fa-solid fa-list-check"></i>
    <i class="fa-solid fa-robot"></i>
    <i class="fa-solid fa-users"></i>
    <i class="fa-solid fa-crown" onclick="location.href='deposit.html'"></i>
  </div>
</div>

<script type="module">
/* ===== FIREBASE ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  setDoc,
  updateDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1HZLZRY9UADNnDVBnoBIlG3b-bCkojxs",
  authDomain: "primeinvestproject2.firebaseapp.com",
  projectId: "primeinvestproject2",
  storageBucket: "primeinvestproject2.firebasestorage.app",
  messagingSenderId: "798977477628",
  appId: "1:798977477628:web:c97d1fba72ad7865864079"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== RULES ===== */
const SCORE_PER_DOLLAR = 10000000;
const DAILY_LIMIT_NO_VIP = 500000;
const MULTI = {0:1,1:5,2:10,3:20,4:40,5:80,6:800,7:8000,8:80000};

/* ===== USER ===== */
function uid(){
  let id = localStorage.getItem("userId");
  if(!id){
    id = "user_"+Math.random().toString(36).slice(2,10)+"_"+Date.now();
    localStorage.setItem("userId", id);
  }
  return id;
}
const userId = uid();
const userRef = doc(db,"users",userId);

/* ===== INIT USER ===== */
async function ensureUser(){
  const snap = await getDoc(userRef);
  if(!snap.exists()){
    await setDoc(userRef,{
      balance:0,
      score:0,
      today:new Date().toDateString(),
      todayScore:0,
      createdAt:serverTimestamp()
    });
  }
}
await ensureUser();

/* ===== LOAD USER ===== */
let userData = (await getDoc(userRef)).data();
let vipLevel = userData?.vip?.level || 0;

/* ===== RESET DAILY ===== */
const today = new Date().toDateString();
if(userData.today !== today){
  await updateDoc(userRef,{ today, todayScore:0 });
  userData.today = today;
  userData.todayScore = 0;
}

/* UI */
const balanceEl = document.getElementById("balance");
const scoreEl = document.getElementById("score");
function refresh(){
  balanceEl.textContent = "$"+(userData.balance||0).toFixed(2);
  scoreEl.textContent = (userData.score||0).toLocaleString();
}
refresh();

/* ===== TAP ===== */
document.getElementById("robot").onclick = async (e)=>{
  const gain = MULTI[vipLevel] || 1;

  if(vipLevel === 0 && (userData.todayScore + gain) > DAILY_LIMIT_NO_VIP){
    alert("Daily limit reached. Upgrade VIP.");
    return;
  }

  userData.score += gain;
  userData.todayScore += gain;

  if(userData.score >= SCORE_PER_DOLLAR){
    const dollars = Math.floor(userData.score / SCORE_PER_DOLLAR);
    userData.score -= dollars * SCORE_PER_DOLLAR;
    userData.balance += dollars;
  }

  await updateDoc(userRef,{
    score:userData.score,
    balance:userData.balance,
    todayScore:userData.todayScore
  });

  refresh();

  const fx=document.createElement("div");
  fx.className="tap-fx";
  fx.style.left=e.clientX+"px";
  fx.style.top=e.clientY+"px";
  fx.textContent="+"+gain;
  document.body.appendChild(fx);
  setTimeout(()=>fx.remove(),1000);
};
</script>

</body>
</html>
