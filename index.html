<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>PrimeGlobalPro</title>

<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  color:#fff;
  background:
    radial-gradient(circle at 18% 18%, rgba(165,120,255,.45), transparent 42%),
    radial-gradient(circle at 82% 75%, rgba(0,220,255,.35), transparent 45%),
    radial-gradient(circle at 40% 85%, rgba(255,160,90,.22), transparent 40%),
    linear-gradient(180deg,#05070f,#0a0f24);
  overflow-x:hidden;
}

/* TOP BAR */
.topbar{
  position:fixed;
  top:12px;
  right:12px;
  z-index:10;
}

.menu-btn{
  background:rgba(255,255,255,.15);
  border:1px solid rgba(255,255,255,.25);
  backdrop-filter:blur(14px);
  border-radius:12px;
  padding:10px 12px;
  font-size:20px;
  cursor:pointer;
  color:#fff;
}

/* MENU */
.menu{
  position:absolute;
  right:0;
  top:48px;
  background:rgba(20,30,50,.97);
  border:1px solid rgba(255,255,255,.2);
  border-radius:16px;
  width:240px;
  display:none;
  overflow:hidden;
}

.menu .user-box{
  padding:14px;
  border-bottom:1px solid rgba(255,255,255,.15);
}

.menu .name{font-weight:800}
.menu .email{font-size:13px;opacity:.8;word-break:break-all}

.menu button{
  width:100%;
  padding:14px;
  background:none;
  border:none;
  color:#fff;
  font-weight:700;
  text-align:left;
  cursor:pointer;
}

.menu button:hover{
  background:rgba(255,255,255,.1);
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:20;
}

.modal-box{
  background:#121a30;
  border-radius:18px;
  padding:18px;
  width:90%;
  max-width:340px;
}

.modal-box h3{text-align:center;margin-top:0}

.modal-box input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:12px;
  border:none;
}

.modal-box button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  font-weight:800;
  background:#22c55e;
  color:#000;
  margin-top:6px;
}

/* MAIN */
.wrap{padding:70px 16px 110px; max-width:420px; margin:0 auto;}

.glass{
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.22);
  box-shadow:0 18px 50px rgba(0,0,0,.35);
  backdrop-filter: blur(18px);
  border-radius:24px;
}

.card{padding:18px;text-align:center}
.amount{font-size:52px;font-weight:900}

.vip-pill{
  display:inline-block;
  padding:8px 14px;
  border-radius:999px;
  background:rgba(255,255,255,0.14);
  border:1px solid rgba(255,255,255,0.18);
  font-weight:700;
}

.tap-area{margin:22px auto 10px;display:flex;justify-content:center}
.orb{
  width:min(250px,72vw);
  height:min(250px,72vw);
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  border:1px solid rgba(255,255,255,.25);
  background:radial-gradient(circle at 30% 30%,#5ff,#0000),
             radial-gradient(circle at 70% 70%,#a7f,#0000),
             rgba(255,255,255,.08);
  font-weight:900;
}

.stats{margin-top:14px;padding:14px}
.row{display:flex;justify-content:space-between;font-weight:700}
</style>
</head>

<body>

<!-- TOP MENU -->
<div class="topbar">
  <button class="menu-btn" id="menuBtn">â‹®</button>
  <div class="menu" id="menu">
    <div class="user-box">
      <div class="name" id="userName">Loading...</div>
      <div class="email" id="userEmail"></div>
    </div>

    <button id="changePassBtn">Change Password</button>
    <button id="adminBtn" style="display:none">Admin Panel</button>
    <button id="logoutBtn">Logout</button>
  </div>
</div>

<!-- CHANGE PASSWORD MODAL -->
<div class="modal" id="passModal">
  <div class="modal-box">
    <h3>Change Password</h3>
    <input id="newPass1" type="password" placeholder="New password">
    <input id="newPass2" type="password" placeholder="Confirm password">
    <button id="savePassBtn">Update Password</button>
  </div>
</div>

<div class="wrap">
  <div class="glass card">
    <div>Balance</div>
    <div class="amount" id="balanceUsd">$0.00</div>
    <div class="vip-pill">VIP: None</div>
  </div>

  <div class="tap-area">
    <div class="orb">TAP</div>
  </div>
</div>

<script type="module" defer>
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged,
  signOut,
  updatePassword
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1HZLZRY9UADNnDVBnoBIlG3b-bCkojxs",
  authDomain: "primeinvestproject2.firebaseapp.com",
  projectId: "primeinvestproject2",
  storageBucket: "primeinvestproject2.firebasestorage.app",
  messagingSenderId: "798977477628",
  appId: "1:798977477628:web:c97d1fba72ad7865864079"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* MENU */
const menuBtn = document.getElementById("menuBtn");
const menu = document.getElementById("menu");
menuBtn.onclick = ()=> menu.style.display = menu.style.display === "block" ? "none" : "block";

/* LOGOUT */
document.getElementById("logoutBtn").onclick = async ()=>{
  await signOut(auth);
  location.replace("auth.html");
};

/* CHANGE PASSWORD */
const modal = document.getElementById("passModal");
document.getElementById("changePassBtn").onclick = ()=>{
  modal.style.display = "flex";
  menu.style.display = "none";
};

document.getElementById("savePassBtn").onclick = async ()=>{
  const p1 = document.getElementById("newPass1").value;
  const p2 = document.getElementById("newPass2").value;

  if(!p1 || p1 !== p2){
    alert("Passwords do not match");
    return;
  }

  try{
    await updatePassword(auth.currentUser, p1);
    alert("Password updated. Please login again.");
    await signOut(auth);
    location.replace("auth.html");
  }catch(e){
    alert("Recent login required. Please login again.");
    await signOut(auth);
    location.replace("auth.html");
  }
};

/* ADMIN */
document.getElementById("adminBtn").onclick = ()=>{
  location.href = "admin_vip.html";
};

/* AUTH + ROLE */
onAuthStateChanged(auth, async user=>{
  if(!user){
    location.replace("auth.html");
    return;
  }

  document.getElementById("userEmail").textContent = user.email;

  const snap = await getDoc(doc(db,"users",user.uid));
  document.getElementById("userName").textContent =
    snap.exists() ? snap.data().fullName || "User" : "User";

  const token = await user.getIdTokenResult();
  if(token.claims.admin){
    document.getElementById("adminBtn").style.display = "block";
  }
});
</script>

</body>
</html>
